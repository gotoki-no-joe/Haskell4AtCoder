# 17.べき乗 \(not yet\)

modで特定の値のいろいろなべき乗を、上限ありで求める場合、事前計算しておいてもお釣りが出るという話。

```haskell
import qualified Data.Vector as V

-- a^b を 0<=b<=num の範囲で先に求める
-- a^b = powerVec a V.! b

num = 1000
modBase = 1000000007

powerVec a = V.iterateN num (mul base) 1

mul a b = mod (a * b) modBase
```

### 関連問題

HHKB プログラミングコンテスト 2020 E Lamps  
この問題の事前問題  
ABC129 D Lamp がTLEしてしまうのでお話にならない段階。

### メモ

$$c \times a ^ b$$で$$b$$が自然数である場合、愚直に$$b$$回乗算を行わず、$$b$$の2進数表現でビットが1であるところだけ、$$a^0,a^1,a^2,a^4,\dots$$をかけ合わせる、という計算をするのに、自分で再帰する

```haskell
powerish :: (a -> a -> a) -> a -> Int -> a
powerish _ _ 0 c = c
powerish f a b c = powerish f (f a a) (div b 2) $
                   if odd b then f c a else c
```

よりもHaskellらしく

```haskell
powerish f a b c = foldl' f c [p | (b,p) <- zip bs ps, odd b]
  where
    bs = takeWhile (0 /=) $ iterate (flip div 2) b
    ps = iterate (\x -> f x x) a
```

とした方が少し早かったのは`foldl'`の正格評価のおかげなだけかも。

